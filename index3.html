<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guess the Country</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #map {
      width: 100%;
      max-width: 800px;
      height: 500px;
      border: 1px solid #ccc;
      touch-action: none;
      background-color: #eaeaea; /* subtle background so countries stand out */
    }
    #controls {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #autocomplete {
      width: 250px;
      padding: 5px;
      font-size: 1em;
    }
    #hintBtn, #resetZoomBtn {
      margin-top: 5px;
      cursor: pointer;
      padding: 8px 14px;
      font-size: 1em;
      border: 1px solid #666;
      background-color: #f0f0f0;
      border-radius: 4px;
      user-select: none;
      transition: background-color 0.2s;
    }
    #hintBtn:hover, #resetZoomBtn:hover {
      background-color: #ddd;
    }
    .country {
      cursor: pointer;
      stroke: #fff;
      stroke-width: 0.5;
      fill: #b0b0b0;
      transition: fill 0.3s;
    }
    .correct {
      fill: green !important;
    }
    .wrong {
      fill: red !important;
    }
    .hovered {
      fill: orange;
    }
    #score {
      margin-top: 10px;
      font-weight: bold;
    }
    #flagCongrats {
      position: fixed;
      top: 30px;
      right: 30px;
      font-size: 4em;
      pointer-events: none;
      user-select: none;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      z-index: 1000;
    }
  </style>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <h2>Guess the Country</h2>
  <div id="map"></div>
  <div id="controls">
    <input id="autocomplete" list="countries" placeholder="Type a country..." autocomplete="off" />
    <button id="hintBtn" type="button">Hint</button>
    <button id="resetZoomBtn" type="button">Reset Zoom</button>
    <div id="score">Score: 0</div>
    <datalist id="countries"></datalist>
  </div>
  <div id="flagCongrats"></div>

  <script>
    const countryData = {
      /* full list omitted here for brevity - same as before */
      "Afghanistan": "Kabul",
      "Albania": "Tirana",
      "Algeria": "Algiers",
      // ... rest omitted, same as previous full list ...
      "Zimbabwe": "Harare"
    };

    // ISO mapping and flag emoji helper, same as before
    const countryNameToISO = {
      "Afghanistan": "AF", "Albania": "AL", "Algeria": "DZ", /* etc. all as before */
      "Zimbabwe": "ZW"
    };

    function getFlagEmoji(countryName) {
      const iso = countryNameToISO[countryName];
      if (!iso) return '';
      return iso.toUpperCase().split('').map(c =>
        String.fromCodePoint(0x1F1E6 + c.charCodeAt(0) - 65)
      ).join('');
    }

    let selectedCountry = null;
    let attempts = {};
    let score = 0;

    const svg = d3.select("#map")
      .append("svg")
      .attr("width", "100%")
      .attr("height", "100%")
      .attr("viewBox", "0 0 800 450");

    const projection = d3.geoNaturalEarth1().scale(130).translate([400, 225]);
    const path = d3.geoPath().projection(projection);

    // Zoom and pan
    const zoom = d3.zoom()
      .scaleExtent([1, 8])
      .on("zoom", (event) => {
        g.attr("transform", event.transform);
      });

    svg.call(zoom);

    const g = svg.append("g");

    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then(function(data) {
      g.selectAll("path")
        .data(data.features)
        .join("path")
        .attr("d", path)
        .attr("class", "country")
        .attr("id", d => d.properties.name)
        .on("click", function(event, d) {
          if (attempts[d.properties.name] === -1) {
            alert("Answer: " + d.properties.name);
            return;
          }
          selectedCountry = d.properties.name;
          document.getElementById("autocomplete").value = "";
          document.getElementById("autocomplete").focus();
        });
      // NO text elements added â€” no place names visible

      const datalist = document.getElementById("countries");
      Object.keys(countryData).forEach(country => {
        const option = document.createElement("option");
        option.value = country;
        datalist.appendChild(option);
      });
    });

    function showFlagCongrats(flag) {
      const flagDiv = document.getElementById("flagCongrats");
      flagDiv.textContent = flag;
      flagDiv.style.opacity = 1;
      setTimeout(() => {
        flagDiv.style.opacity = 0;
      }, 1500);
    }

    function resetZoom() {
      svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
    }

    document.getElementById("resetZoomBtn").addEventListener("click", resetZoom);

    document.getElementById("autocomplete").addEventListener("change", function() {
      const guess = this.value.trim();
      if (!selectedCountry || !guess) return;

      if (!attempts[selectedCountry]) attempts[selectedCountry] = 0;

      if (attempts[selectedCountry] === -1) {
        this.value = "";
        selectedCountry = null;
        return;
      }

      if (guess.toLowerCase() === selectedCountry.toLowerCase()) {
        score += attempts[selectedCountry] === 0 ? 2 : 1;
        d3.select(`#${CSS.escape(selectedCountry)}`).classed("correct", true);
        attempts[selectedCountry] = 999; // solved

        showFlagCongrats(getFlagEmoji(selectedCountry));
      } else {
        attempts[selectedCountry]++;
        if (attempts[selectedCountry] >= 3) {
          d3.select(`#${CSS.escape(selectedCountry)}`).classed("wrong", true);
          attempts[selectedCountry] = -1; // lock
        }
      }

      document.getElementById("score").textContent = `Score: ${score}`;
      this.value = "";
      selectedCountry = null;
    });

    document.getElementById("hintBtn").addEventListener("click", function() {
      if (!selectedCountry) {
        alert("Select a country first.");
        return;
      }
      const capital = countryData[selectedCountry];
      if (capital) alert("Capital: " + capital);
      else alert("No capital data available.");
    });
  </script>
</body>
</html>
